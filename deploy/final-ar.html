<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–†–∞–±–æ—á–∏–π AR –ë—É—Ä–≥–µ—Ä</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
        }
        .loading.hidden {
            display: none;
        }
        .error-message {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            z-index: 1001;
            max-width: 90%;
        }
        .error-message.hidden {
            display: none;
        }
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <h2>üçî –ó–∞–≥—Ä—É–∑–∫–∞ AR –ë—É—Ä–≥–µ—Ä–∞</h2>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
        <div id="loading-status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    </div>
    
    <div id="error-message" class="error-message hidden">
        <div id="error-text"></div>
        <button onclick="retryAR()" style="margin-top: 10px; padding: 8px 16px; background: white; color: black; border: none; border-radius: 5px; cursor: pointer;">
            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
        </button>
    </div>
    
    <div class="instructions">
        –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä Hiro –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è 3D –±—É—Ä–≥–µ—Ä–∞
    </div>

    <a-scene 
        id="ar-scene"
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
        renderer="logarithmicDepthBuffer: true; antialias: true;"
        vr-mode-ui="enabled: false">
        
        <a-marker id="hiro-marker" preset="hiro">
            <a-entity light="type: ambient; intensity: 1.5;"></a-entity>
            <a-entity light="type: directional; intensity: 1.5;" position="1 4 3"></a-entity>
            
            <a-entity
                id="burger-model"
                gltf-model="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Duck/glTF/Duck.gltf"
                scale="0.5 0.5 0.5"
                position="0 0 0"
                rotation="0 0 0">
            </a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let sceneLoaded = false;
        let cameraStarted = false;
        
        function updateLoadingStatus(text) {
            document.getElementById('loading-status').textContent = text;
            console.log('[LOADING]', text);
        }
        
        function showError(message) {
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-message').classList.remove('hidden');
            document.getElementById('loading').classList.add('hidden');
            console.error('[ERROR]', message);
        }
        
        function hideError() {
            document.getElementById('error-message').classList.add('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞
        function checkBrowserSupport() {
            updateLoadingStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞...');
            
            if (!navigator.mediaDevices) {
                showError('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome, Edge –∏–ª–∏ Firefox.');
                return false;
            }
            
            if (!navigator.mediaDevices.getUserMedia) {
                showError('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç getUserMedia API.');
                return false;
            }
            
            return true;
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
        function setupCameraAutoStart() {
            updateLoadingStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã...');
            
            // Touch events –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            document.addEventListener('touchstart', function startCameraTouch() {
                if (!cameraStarted) {
                    startCamera();
                    document.removeEventListener('touchstart', startCameraTouch);
                }
            });
            
            // Click events –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
            document.addEventListener('click', function startCameraClick() {
                if (!cameraStarted) {
                    startCamera();
                    document.removeEventListener('click', startCameraClick);
                }
            });
            
            // –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            setTimeout(startCamera, 2000);
        }
        
        function startCamera() {
            if (cameraStarted) return;
            
            updateLoadingStatus('–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...');
            
            const video = document.querySelector('#arjs-video');
            if (video) {
                video.play()
                    .then(() => {
                        cameraStarted = true;
                        updateLoadingStatus('–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
                        console.log('[CAMERA] Started successfully');
                    })
                    .catch(err => {
                        console.log('[CAMERA] Autoplay blocked:', err);
                        updateLoadingStatus('–ö–æ—Å–Ω–∏—Ç–µ—Å—å —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã');
                    });
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã
        document.querySelector('#ar-scene').addEventListener('loaded', function() {
            sceneLoaded = true;
            updateLoadingStatus('–°—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            console.log('[SCENE] Loaded');
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ä–∫–µ—Ä–∞
        document.querySelector('#hiro-marker').addEventListener('markerFound', function() {
            hideLoading();
            hideError();
            console.log('[MARKER] Found');
        });
        
        document.querySelector('#hiro-marker').addEventListener('markerLost', function() {
            console.log('[MARKER] Lost');
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ A-Frame
        AFRAME.registerComponent('error-handler', {
            init: function() {
                this.el.addEventListener('componenterror', function(evt) {
                    console.error('[AFRAME ERROR]', evt.detail);
                });
            }
        });
        
        // Retry function
        function retryAR() {
            hideError();
            document.getElementById('loading').classList.remove('hidden');
            cameraStarted = false;
            sceneLoaded = false;
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∫ –∫—Ä–∞–π–Ω—è—è –º–µ—Ä–∞
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', function() {
            console.log('[INIT] Starting AR Burger');
            
            if (!checkBrowserSupport()) {
                return;
            }
            
            setupCameraAutoStart();
            
            // Timeout –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
            setTimeout(() => {
                if (!sceneLoaded) {
                    showError('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
                }
            }, 15000);
        });
        
        console.log('[APP] AR Burger initialized');
    </script>
</body>
</html>